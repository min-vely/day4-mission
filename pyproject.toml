# ğŸ†• 4ê°•: CI/CD íŒŒì´í”„ë¼ì¸
# uv íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¥¼ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼
#
# ì‚¬ìš©ë²•:
#   uv sync          # ì˜ì¡´ì„± ì„¤ì¹˜
#   uv run uvicorn app.main:app --reload  # ì„œë²„ ì‹¤í–‰
#   uv run pytest tests/ -v               # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
#
# ğŸ†• 4ê°• ë³€ê²½ì‚¬í•­:
#   - pytest ë§ˆì»¤ ì„¤ì • ì¶”ê°€
#   - ruff ì„¤ì • ê°•í™”
#   - pre-commit í›… ë„ì…
#   - GitHub Actionsì—ì„œ ì‚¬ìš©

[project]
name = "lumi-agent"
version = "0.4.0"
description = "ë£¨ë¯¸(Lumi) - ë²„ì¶”ì–¼ ì•„ì´ëŒ AI ì—ì´ì „íŠ¸ ì„œë¹„ìŠ¤"
readme = "README.md"
requires-python = ">=3.11"

# í•µì‹¬ ì˜ì¡´ì„±
# - LangGraph: ì—ì´ì „íŠ¸ ì›Œí¬í”Œë¡œìš° í”„ë ˆì„ì›Œí¬
# - FastAPI: ë¹„ë™ê¸° ì›¹ í”„ë ˆì„ì›Œí¬
# - Upstage: Solar LLM API
# - Supabase: PostgreSQL + pgvector ë°ì´í„°ë² ì´ìŠ¤
dependencies = [
    # ===== LangGraph & LangChain =====
    "langgraph>=1.0.0",                  # ê·¸ë˜í”„ ê¸°ë°˜ ì—ì´ì „íŠ¸ í”„ë ˆì„ì›Œí¬
    "langchain-core>=1.0.0",             # LangChain í•µì‹¬ ëª¨ë“ˆ
    "langchain-upstage>=0.5.0",          # Upstage Solar API ì—°ë™
    "langchain-community>=0.3.0",        # ì»¤ë®¤ë‹ˆí‹° í†µí•© ëª¨ë“ˆ

    # ===== Web Framework =====
    "fastapi>=0.125.0",                  # ë¹„ë™ê¸° ì›¹ í”„ë ˆì„ì›Œí¬
    "uvicorn[standard]>=0.32.0",         # ASGI ì„œë²„

    # ===== Database & Cache =====
    "supabase>=2.20.0",                  # Supabase Python í´ë¼ì´ì–¸íŠ¸

    # ===== Configuration =====
    "pydantic>=2.0.0",                   # ë°ì´í„° ê²€ì¦
    "pydantic-settings>=2.0.0",          # í™˜ê²½ë³€ìˆ˜ ì„¤ì • ê´€ë¦¬
    "python-dotenv>=1.0.0",              # .env íŒŒì¼ ë¡œë“œ

    # ===== Utilities =====
    "httpx>=0.27.0",                     # ë¹„ë™ê¸° HTTP í´ë¼ì´ì–¸íŠ¸
    "loguru>=0.7.0",                     # ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬
    "orjson>=3.10.0",                    # ë¹ ë¥¸ JSON ì²˜ë¦¬

    # Gradio UI
    "gradio>=5.0.0",                     # ì›¹ UI í”„ë ˆì„ì›Œí¬

    # SSE ìŠ¤íŠ¸ë¦¬ë°
    "sse-starlette>=2.1.0",              # Server-Sent Events ì§€ì›
]

[project.optional-dependencies]
# ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© ì˜ì¡´ì„± ê°•í™”
dev = [
    "pytest>=8.0.0",                     # í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
    "pytest-asyncio>=0.24.0",            # ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ ì§€ì›
    "pytest-cov>=4.0.0",                 # ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
    "black>=24.0.0",                     # ì½”ë“œ í¬ë§¤í„°
    "ruff>=0.8.0",                       # ë¦°í„° (flake8 ëŒ€ì²´)
    "mypy>=1.0.0",                       # íƒ€ì… ì²´ì»¤
    "pre-commit>=4.0.0",                 # Git í›… ê´€ë¦¬
]


[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.build.targets.wheel]
packages = ["app"]

# =============================================================
# Pytest ì„¤ì •
# =============================================================
[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
# í…ŒìŠ¤íŠ¸ ë§ˆì»¤ ì •ì˜
markers = [
    "slow: ëŠë¦° í…ŒìŠ¤íŠ¸ (LLM API í˜¸ì¶œ)",
    "integration: í†µí•© í…ŒìŠ¤íŠ¸",
]
# ê¸°ë³¸ ì˜µì…˜
addopts = [
    "-v",
    "--tb=short",
]
# í†µí•© í…ŒìŠ¤íŠ¸ ì œì™¸ (ê¸°ë³¸)
# í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰: uv run pytest -m integration
filterwarnings = [
    "ignore::DeprecationWarning",
]

# =============================================================
# Ruff ì„¤ì • (ë¦°í„°)
# =============================================================
[tool.ruff]
line-length = 88
target-version = "py311"

[tool.ruff.lint]
# í™œì„±í™”í•  ê·œì¹™
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # Pyflakes
    "I",      # isort
    "B",      # flake8-bugbear
    "C4",     # flake8-comprehensions
    "UP",     # pyupgrade
]
# ë¬´ì‹œí•  ê·œì¹™
ignore = [
    "E501",   # line too long (blackì´ ì²˜ë¦¬)
    "B008",   # function call in default argument (FastAPI Depends)
    "B904",   # raise without from (ì˜ë„ì ì¸ ê²½ìš°)
]

[tool.ruff.lint.per-file-ignores]
"tests/*" = ["B", "C4"]  # í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ ì¼ë¶€ ê·œì¹™ ì™„í™”

[tool.ruff.lint.isort]
known-first-party = ["app"]

# =============================================================
# Black ì„¤ì • (í¬ë§¤í„°)
# =============================================================
[tool.black]
line-length = 88
target-version = ["py311"]
include = '\.pyi?$'
exclude = '''
/(
    \.git
  | \.venv
  | __pycache__
  | \.mypy_cache
)/
'''
